{"ast":null,"code":"var _jsxFileName = \"/Users/weixinliang/Desktop/project3/current/learnlocal-p3/client/src/components/ClassCard/MapTest.js\";\nimport React from 'react';\nimport { Link } from 'react-router-dom';\nimport styles from './MapClassCard.css';\nimport ReactMapboxGl from 'react-mapbox-gl';\nimport ClassCard from './ClassCard';\nimport axios from 'axios';\nimport Geocode from 'react-geocode';\nimport GeoCard from './GeoCard';\nGeocode.setApiKey('AIzaSyDnRYpEtmDx_-7PQ_xHhiF9els9bGTI6t4');\nGeocode.enableDebug();\nconst Map = ReactMapboxGl({\n  accessToken: 'pk.eyJ1IjoibGVhcm5sb2NhbCIsImEiOiJjanlkZ2dram4wcHY1M2ptZm8wNGZrNzVkIn0.SnFaLsmeVQkX5XSj8-pp-A'\n});\n\nconst converter = address => {\n  Geocode.fromAddress(address).then(response => {\n    const _response$results$0$g = response.results[0].geometry.location,\n          lat = _response$results$0$g.lat,\n          lng = _response$results$0$g.lng;\n    console.log(address);\n    console.log(lat, lng);\n  }, error => {\n    console.error(error);\n  }); // return [lat, lng]\n};\n\nconst chapters = {\n  'wooden-heart-pendants': {\n    bearing: 27,\n    center: [-122.59213, 37.983088],\n    zoom: 15.5,\n    pitch: 20\n  },\n  'aldgate': {\n    duration: 6000,\n    center: [-0.07571203, 51.51424049],\n    bearing: 150,\n    zoom: 15,\n    pitch: 0\n  },\n  'london-bridge': {\n    bearing: 90,\n    center: [-0.08533793, 51.50438536],\n    zoom: 13,\n    speed: 0.6,\n    pitch: 40\n  }\n};\nlet activeChapterName = 'wooden-heart-pendants';\nlet data = {};\n\nclass MapTest extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      profiles: []\n    };\n\n    this.getGeocode = addresses => {\n      addresses.map(address => {\n        Geocode.fromAddress(address).then(response => {\n          const _response$results$0$g2 = response.results[0].geometry.location,\n                lat = _response$results$0$g2.lat,\n                lng = _response$results$0$g2.lng;\n          console.log(lat, lng);\n        }, error => {\n          console.error(error);\n        });\n      });\n    };\n\n    this.handleScroll = () => {\n      const chapterNames = Object.keys(chapters);\n\n      for (let i = 0; i < chapterNames.length; i++) {\n        let chapterName = chapterNames[i];\n\n        if (this.isElementOnScreen(chapterName)) {\n          console.log('handleScroll | chapterName', chapterName);\n          this.setActiveChapter(chapterName);\n          break;\n        }\n      }\n    };\n\n    this.setActiveChapter = chapterName => {\n      if (chapterName === activeChapterName) return;\n      console.log('setActiveChapter | setState to', chapters[activeChapterName]['center']);\n      this.setState({\n        'center': chapters[activeChapterName]['center']\n      });\n      document.getElementById(chapterName).setAttribute('class', 'active');\n      document.getElementById(activeChapterName).setAttribute('class', '');\n      activeChapterName = chapterName;\n    };\n\n    this.isElementOnScreen = id => {\n      const element = document.getElementById(id);\n      const bounds = element.getBoundingClientRect();\n      return bounds.top < window.innerHeight && bounds.bottom - 1000 > 0;\n    };\n  }\n\n  componentDidMount() {\n    window.addEventListener('scroll', this.handleScroll);\n    axios.get('/api/profile').then(res => {\n      this.setState({\n        profiles: res.data\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  addClassCard() {\n    return this.state.profiles.map(profile => {\n      return React.createElement(GeoCard, {\n        event: profile.events,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 93\n        },\n        __self: this\n      });\n    });\n  }\n\n  getAllEvents() {\n    let events = [];\n    return this.state.profiles.map(profile => {\n      events.push(...profile.event);\n      return React.createElement(ClassCard, {\n        event: events,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 100\n        },\n        __self: this\n      });\n    });\n  } // addChapters() {\n  //   let chapters = {}\n  //   this.state.profiles.map(profile => {\n  //     chapters.profile.event\n  //   })\n  // }\n\n\n  componentWillUnmount() {\n    window.removeEventListener('scroll', this.handleScroll);\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"MapClassCardContainer\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149\n      },\n      __self: this\n    }, React.createElement(Map, {\n      style: \"mapbox://styles/mapbox/streets-v10\",\n      center: [-122.27087, 37.87189],\n      zoom: [15.0],\n      bearing: [0],\n      pitch: [0],\n      className: \"the-map\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      id: \"features\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159\n      },\n      __self: this\n    }, this.addClassCard()));\n  }\n\n}\n\nexport default MapTest;","map":{"version":3,"sources":["/Users/weixinliang/Desktop/project3/current/learnlocal-p3/client/src/components/ClassCard/MapTest.js"],"names":["React","Link","styles","ReactMapboxGl","ClassCard","axios","Geocode","GeoCard","setApiKey","enableDebug","Map","accessToken","converter","address","fromAddress","then","response","results","geometry","location","lat","lng","console","log","error","chapters","bearing","center","zoom","pitch","duration","speed","activeChapterName","data","MapTest","Component","state","profiles","getGeocode","addresses","map","handleScroll","chapterNames","Object","keys","i","length","chapterName","isElementOnScreen","setActiveChapter","setState","document","getElementById","setAttribute","id","element","bounds","getBoundingClientRect","top","window","innerHeight","bottom","componentDidMount","addEventListener","get","res","catch","err","addClassCard","profile","events","getAllEvents","push","event","componentWillUnmount","removeEventListener","render"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { Link } from 'react-router-dom'\nimport styles from './MapClassCard.css'\nimport ReactMapboxGl from 'react-mapbox-gl'\nimport ClassCard from './ClassCard'\nimport axios from 'axios'\nimport Geocode from 'react-geocode'\nimport GeoCard from './GeoCard'\n\n\nGeocode.setApiKey('AIzaSyDnRYpEtmDx_-7PQ_xHhiF9els9bGTI6t4')\n\nGeocode.enableDebug()\n\nconst Map = ReactMapboxGl({\n  accessToken: 'pk.eyJ1IjoibGVhcm5sb2NhbCIsImEiOiJjanlkZ2dram4wcHY1M2ptZm8wNGZrNzVkIn0.SnFaLsmeVQkX5XSj8-pp-A'\n})\n\nconst converter = (address) =>{\n        Geocode.fromAddress(address).then(\n            response => {\n              const { lat, lng } = response.results[0].geometry.location\n              console.log(address)\n              console.log(lat, lng)\n            },\n            error => {\n              console.error(error)\n            }\n      )\n  // return [lat, lng]\n    \n}\nconst chapters = {\n  'wooden-heart-pendants': {\n    bearing: 27,\n    center: [-122.59213, 37.983088],\n    zoom: 15.5,\n    pitch: 20\n  },\n  'aldgate': {\n    duration: 6000,\n    center: [-0.07571203, 51.51424049],\n    bearing: 150,\n    zoom: 15,\n    pitch: 0\n  },\n  'london-bridge': {\n    bearing: 90,\n    center: [-0.08533793, 51.50438536],\n    zoom: 13,\n    speed: 0.6,\n    pitch: 40\n    }\n}\n\nlet activeChapterName = 'wooden-heart-pendants';\nlet data = {}\n\nclass MapTest extends React.Component {\n    state = {\n         profiles: []\n    }\n\n    \n\n    getGeocode = (addresses) => {\n        addresses.map(address => {\n            Geocode.fromAddress(address).then(\n                response => {\n                  const { lat, lng } = response.results[0].geometry.location;\n                  console.log(lat, lng);\n                },\n                error => {\n                  console.error(error);\n                }\n              );\n        })        \n    }\n    \n    componentDidMount() {\n        window.addEventListener('scroll', this.handleScroll);\n        axios.get('/api/profile')\n        .then(res => {\n            this.setState({ profiles: res.data })  \n        })\n        .catch(err => {\n            console.log(err)\n        })\n        \n    }\n    addClassCard() {\n      return this.state.profiles.map(profile => {\n        return <GeoCard event={profile.events} />\n      })\n    }\n    getAllEvents() {\n      let events=[]\n      return this.state.profiles.map(profile => {\n        events.push(...profile.event)\n        return <ClassCard event={events} />\n      })\n    }\n    // addChapters() {\n    //   let chapters = {}\n    //   this.state.profiles.map(profile => {\n    //     chapters.profile.event\n    //   })\n\n\n    // }\n\n    \n    componentWillUnmount() {\n        window.removeEventListener('scroll', this.handleScroll);\n        \n    }\n\n    handleScroll = () => {\n        const chapterNames = Object.keys(chapters);\n        for (let i = 0; i < chapterNames.length; i++) {\n            let chapterName = chapterNames[i];\n            if (this.isElementOnScreen(chapterName)) {\n                console.log('handleScroll | chapterName', chapterName)\n                this.setActiveChapter(chapterName);\n                break;\n            }\n        }\n    }\n\n    setActiveChapter = (chapterName) => {\n        if (chapterName === activeChapterName) return;\n        console.log('setActiveChapter | setState to', chapters[activeChapterName]['center'])\n        this.setState({'center': chapters[activeChapterName]['center']})\n         \n        document.getElementById(chapterName).setAttribute('class', 'active');\n        document.getElementById(activeChapterName).setAttribute('class', '');\n         \n        activeChapterName = chapterName;\n        }\n\n    isElementOnScreen = (id) => {\n        const element = document.getElementById(id);\n        const bounds = element.getBoundingClientRect();\n        return bounds.top < window.innerHeight && bounds.bottom-1000 > 0;\n    }\n\n  render () {\n    return (\n      <div className='MapClassCardContainer'>\n         \n            <Map \n            style='mapbox://styles/mapbox/streets-v10' \n            center={[-122.27087, 37.87189]}\n            zoom={[15.0]}\n            bearing={[0]}\n            pitch={[0]}\n            className='the-map'\n        />\n        <div id='features'>\n         {this.addClassCard()}\n         </div>\n      </div>\n    )\n  }\n}\n\nexport default MapTest\n"]},"metadata":{},"sourceType":"module"}