{"ast":null,"code":"var _jsxFileName = \"/Users/weixinliang/Desktop/project3/current/learnlocal-p3/client/src/components/ClassCard/MapTest.js\";\nimport React from 'react';\nimport { Link } from 'react-router-dom';\nimport styles from './MapClassCard.css';\nimport ReactMapboxGl from 'react-mapbox-gl';\nimport ClassCard from './ClassCard';\nimport axios from 'axios';\nimport Geocode from 'react-geocode';\nimport GeoCard from './GeoCard';\nGeocode.setApiKey('AIzaSyDnRYpEtmDx_-7PQ_xHhiF9els9bGTI6t4');\nGeocode.enableDebug();\nconst Map = ReactMapboxGl({\n  accessToken: 'pk.eyJ1IjoibGVhcm5sb2NhbCIsImEiOiJjanlkZ2dram4wcHY1M2ptZm8wNGZrNzVkIn0.SnFaLsmeVQkX5XSj8-pp-A'\n});\nconst chapters = {\n  'wooden-heart-pendants': {\n    bearing: 27,\n    center: [-122.59213, 37.983088],\n    zoom: 15.5,\n    pitch: 20\n  },\n  'aldgate': {\n    duration: 6000,\n    center: [-0.07571203, 51.51424049],\n    bearing: 150,\n    zoom: 15,\n    pitch: 0\n  },\n  'london-bridge': {\n    bearing: 90,\n    center: [-0.08533793, 51.50438536],\n    zoom: 13,\n    speed: 0.6,\n    pitch: 40\n  }\n};\nlet activeChapterName = 'wooden-heart-pendants';\n\nclass MapTest extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      profiles: [],\n      chapters: {},\n      center: [-122.27087, 37.87189],\n      zoom: [15.0],\n      bearing: [0],\n      pitch: [0]\n    };\n\n    this.handleScroll = () => {\n      const chapterNames = Object.keys(this.state.chapters);\n      console.log(this.state);\n\n      for (let i = 0; i < chapterNames.length; i++) {\n        let chapterName = chapterNames[i];\n\n        if (this.isElementOnScreen(chapterName)) {\n          console.log('handleScroll | chapterName', chapterName);\n          this.setActiveChapter(chapterName);\n          break;\n        }\n      }\n    };\n\n    this.setActiveChapter = chapterName => {\n      if (chapterName === activeChapterName) return;\n      console.log('setActiveChapter | setState to', this.state.chapters[activeChapterName]['center']);\n      this.setState({\n        'center': this.state.chapters[activeChapterName]['center']\n      });\n      document.getElementById(chapterName).setAttribute('className', 'active');\n      document.getElementById(activeChapterName).setAttribute('className', '');\n      activeChapterName = chapterName;\n    };\n\n    this.isElementOnScreen = id => {\n      const element = document.getElementById(id);\n      console.log(element);\n      const bounds = element.getBoundingClientRect();\n      return bounds.top < window.innerHeight && bounds.bottom - 1000 > 0;\n    };\n  }\n\n  getGeocode(address) {\n    Geocode.fromAddress(address).then(response => {\n      const _response$results$0$g = response.results[0].geometry.location,\n            lat = _response$results$0$g.lat,\n            lng = _response$results$0$g.lng;\n    }, error => {\n      console.error(error);\n    });\n  }\n\n  componentDidMount() {\n    axios.get('/api/profile').then(res => {\n      this.setState({\n        profiles: res.data\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n    this.setState({\n      chapters: this.addChapters()\n    });\n    window.addEventListener('scroll', this.handleScroll);\n  }\n\n  addClassCard() {\n    return this.state.profiles.map(profile => {\n      return React.createElement(GeoCard, {\n        event: profile.events,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83\n        },\n        __self: this\n      });\n    });\n  }\n\n  addChapters() {\n    const chaps = [];\n    const newChaps = {};\n    this.state.profiles.map(profile => {\n      chaps.push(this.makeChapters(profile.events));\n    });\n    chaps.map(chap => {\n      if (Object.keys(chap).length === 1) {\n        newChaps[Object.keys(chap)[0]] = Object.values(chap)[0];\n      }\n\n      if (Object.keys(chap).length > 1) {\n        Object.keys(chap).map((k, i) => {\n          newChaps[k] = Object.values(chap)[i];\n        });\n      }\n    });\n    return newChaps;\n  }\n\n  makeChapters(events) {\n    const allevents = {};\n    events.map(event => {\n      allevents[event.eventName.replace(/\\s+/g, '-').toLowerCase()] = {\n        address: event.location,\n        bearing: 90,\n        center: [-0.08533793, 51.50438536],\n        zoom: 13,\n        pitch: 40\n      };\n    });\n    return allevents;\n  }\n\n  componentWillUnmount() {\n    this.setState({\n      chapters: this.addChapters()\n    });\n    window.removeEventListener('scroll', this.handleScroll);\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"MapClassCardContainer\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164\n      },\n      __self: this\n    }, React.createElement(Map, {\n      style: \"mapbox://styles/mapbox/streets-v10\",\n      center: [-122.27087, 37.87189],\n      zoom: [15.0],\n      bearing: [0],\n      pitch: [0],\n      className: \"the-map\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      id: \"features\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174\n      },\n      __self: this\n    }, this.addClassCard()));\n  }\n\n}\n\nexport default MapTest;","map":{"version":3,"sources":["/Users/weixinliang/Desktop/project3/current/learnlocal-p3/client/src/components/ClassCard/MapTest.js"],"names":["React","Link","styles","ReactMapboxGl","ClassCard","axios","Geocode","GeoCard","setApiKey","enableDebug","Map","accessToken","chapters","bearing","center","zoom","pitch","duration","speed","activeChapterName","MapTest","Component","state","profiles","handleScroll","chapterNames","Object","keys","console","log","i","length","chapterName","isElementOnScreen","setActiveChapter","setState","document","getElementById","setAttribute","id","element","bounds","getBoundingClientRect","top","window","innerHeight","bottom","getGeocode","address","fromAddress","then","response","results","geometry","location","lat","lng","error","componentDidMount","get","res","data","catch","err","addChapters","addEventListener","addClassCard","map","profile","events","chaps","newChaps","push","makeChapters","chap","values","k","allevents","event","eventName","replace","toLowerCase","componentWillUnmount","removeEventListener","render"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { Link } from 'react-router-dom'\nimport styles from './MapClassCard.css'\nimport ReactMapboxGl from 'react-mapbox-gl'\nimport ClassCard from './ClassCard'\nimport axios from 'axios'\nimport Geocode from 'react-geocode'\nimport GeoCard from './GeoCard'\n\n\nGeocode.setApiKey('AIzaSyDnRYpEtmDx_-7PQ_xHhiF9els9bGTI6t4')\n\nGeocode.enableDebug()\n\nconst Map = ReactMapboxGl({\n  accessToken: 'pk.eyJ1IjoibGVhcm5sb2NhbCIsImEiOiJjanlkZ2dram4wcHY1M2ptZm8wNGZrNzVkIn0.SnFaLsmeVQkX5XSj8-pp-A'\n})\n\n\nconst chapters = {\n  'wooden-heart-pendants': {\n    bearing: 27,\n    center: [-122.59213, 37.983088],\n    zoom: 15.5,\n    pitch: 20\n  },\n  'aldgate': {\n    duration: 6000,\n    center: [-0.07571203, 51.51424049],\n    bearing: 150,\n    zoom: 15,\n    pitch: 0\n  },\n  'london-bridge': {\n    bearing: 90,\n    center: [-0.08533793, 51.50438536],\n    zoom: 13,\n    speed: 0.6,\n    pitch: 40\n  }\n}\n\nlet activeChapterName = 'wooden-heart-pendants';\n\nclass MapTest extends React.Component {\n  state = {\n    profiles: [],\n    chapters: {},\n    center: [-122.27087, 37.87189],\n    zoom: [15.0],\n    bearing: [0],\n    pitch: [0]\n  }\n\n\n\n  getGeocode(address) {\n    Geocode.fromAddress(address).then(\n      response => {\n        const { lat, lng } = response.results[0].geometry.location;\n      },\n      error => {\n        console.error(error);\n      }\n    )\n  }\n\n\n  componentDidMount() { \n    axios.get('/api/profile')\n      .then(res => {\n        this.setState({ profiles: res.data })\n      })\n      .catch(err => {\n        console.log(err)\n      })\n\n    this.setState({ chapters: this.addChapters() })\n    window.addEventListener('scroll', this.handleScroll);\n  }\n  addClassCard() {\n    return this.state.profiles.map(profile => {\n      return <GeoCard event={profile.events} />\n    })\n  }\n\n  addChapters() {\n    const chaps = []\n    const newChaps = {}\n    this.state.profiles.map(profile => {\n      chaps.push(this.makeChapters(profile.events))\n    })\n\n    chaps.map(chap => {\n        if (Object.keys(chap).length  === 1) {\n          newChaps[Object.keys(chap)[0]] = Object.values(chap)[0]\n        } \n        if (Object.keys(chap).length  > 1) {\n          Object.keys(chap).map( (k,i) => {\n            newChaps[k] = Object.values(chap)[i]\n          })\n        }\n    })\n   return newChaps\n  }\n\n  makeChapters(events) {\n    const allevents = {}\n    events.map(event => {\n      allevents[event.eventName.replace(/\\s+/g, '-').toLowerCase()] = {\n        address: event.location,\n        bearing: 90,\n        center: [-0.08533793, 51.50438536],\n        zoom: 13,\n        pitch: 40\n      }\n    })\n    return allevents\n\n  }\n\n\n\n  componentWillUnmount() {\n    this.setState({ chapters: this.addChapters() })\n    window.removeEventListener('scroll', this.handleScroll);\n    \n  }\n\n  handleScroll = () => {\n    \n    const chapterNames = Object.keys(this.state.chapters);\n    console.log(this.state)\n    for (let i = 0; i < chapterNames.length; i++) {\n      let chapterName = chapterNames[i];\n      if (this.isElementOnScreen(chapterName)) {\n        console.log('handleScroll | chapterName', chapterName)\n        this.setActiveChapter(chapterName);\n        break;\n      }\n    }\n  }\n\n  setActiveChapter = (chapterName) => {\n    if (chapterName === activeChapterName) return;\n    console.log('setActiveChapter | setState to', this.state.chapters[activeChapterName]['center'])\n    this.setState({ 'center': this.state.chapters[activeChapterName]['center'] })\n\n    document.getElementById(chapterName).setAttribute('className', 'active');\n    document.getElementById(activeChapterName).setAttribute('className', '');\n\n    activeChapterName = chapterName;\n  }\n\n  isElementOnScreen = (id) => {\n    const element = document.getElementById(id);\n    console.log(element)\n    const bounds = element.getBoundingClientRect();\n    return bounds.top < window.innerHeight && bounds.bottom - 1000 > 0;\n  }\n\n  render() {\n    return (\n      <div className='MapClassCardContainer'>\n\n        <Map\n          style='mapbox://styles/mapbox/streets-v10'\n          center={[-122.27087, 37.87189]}\n          zoom={[15.0]}\n          bearing={[0]}\n          pitch={[0]}\n          className='the-map'\n        />\n        <div id='features'>\n        \n          {this.addClassCard()}\n          {/* {this.addChapters()} */}\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default MapTest\n"]},"metadata":{},"sourceType":"module"}